<!DOCTYPE html><html lang="en-US" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="Learning Kubernetes" /><meta property="og:locale" content="en_US" /><meta name="description" content="I run a few services for the threat intelligence and hunting course that I teach, including CAPE, MISP, and Caldera. Last semester, I used a few VMs and Docker to provide these, but I wanted to learn Kubernetes. Here are some notes on migrating over." /><meta property="og:description" content="I run a few services for the threat intelligence and hunting course that I teach, including CAPE, MISP, and Caldera. Last semester, I used a few VMs and Docker to provide these, but I wanted to learn Kubernetes. Here are some notes on migrating over." /><link rel="canonical" href="https://kimobu.github.io/posts/Kubernetes/" /><meta property="og:url" content="https://kimobu.github.io/posts/Kubernetes/" /><meta property="og:site_name" content="kimobu" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-01-01T00:00:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Learning Kubernetes" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-01-01T00:00:00-05:00","datePublished":"2024-01-01T00:00:00-05:00","description":"I run a few services for the threat intelligence and hunting course that I teach, including CAPE, MISP, and Caldera. Last semester, I used a few VMs and Docker to provide these, but I wanted to learn Kubernetes. Here are some notes on migrating over.","headline":"Learning Kubernetes","mainEntityOfPage":{"@type":"WebPage","@id":"https://kimobu.github.io/posts/Kubernetes/"},"url":"https://kimobu.github.io/posts/Kubernetes/"}</script><title>Learning Kubernetes | kimobu</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="kimobu"><meta name="application-name" content="kimobu"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">kimobu</a></div><div class="site-subtitle font-italic">Docendo discimus</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/kimobu" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['kimo','kimobu.space'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://infosec.exchange/@kimobu" aria-label="mastodon" target="_blank" rel="noopener"> <i class="fab fa-mastodon"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Learning Kubernetes</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Learning Kubernetes</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Kimo B </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Jan 1, 2024, 12:00 AM -0500" prep="on" > Jan 1 <i class="unloaded">2024-01-01T00:00:00-05:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1572 words">8 min</span></div></div><div class="post-content"><p>I run a few services for the threat intelligence and hunting course that I teach, including <a href="https://github.com/kevoreilly/CAPEv2">CAPE</a>, <a href="https://www.misp-project.org">MISP</a>, and <a href="https://caldera.mitre.org">Caldera</a>. Last semester, I used a few VMs and Docker to provide these, but I wanted to learn Kubernetes. Here are some notes on migrating over.</p><h1 id="getting-started">Getting Started</h1><p>I started trying Kubernetes the hard way but ultimately ended up using <a href="https://microk8s.io/#install-microk8s">microk8s</a>. The install guide was straight forward. I made 1x control plane node and 2x worker nodes. I used <a href="https://www.robert-jensen.dk/posts/2021-microk8s-with-traefik-and-metallb/">this blog</a> as a starting point. I used Robertâ€™s suggestion for <code class="language-plaintext highlighter-rouge">nfs-subdir-external-provisioner</code> to provide the persistent storage for my pods.</p><p>One of the first things I looked at was providing access to the services. I previously used Nginx as a reverse proxy, and sent requests to each service based on the hostname requested. For example, going to misp.jhu-ctih.training sent the students to the MISP server. With Kubernetes, I learned about <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/#load-balancing">LoadBalancers</a> to do the same thing. Since I self-host I used <a href="https://metallb.org">MetalLB</a>. This was setup with one line: <code class="language-plaintext highlighter-rouge">microk8s enable metallb:&lt;start_ip&gt;-&lt;end_ip&gt;</code>. Instead of Nginx, I used Traefik.</p><h1 id="adding-services">Adding services</h1><p>MISP and Caldera provide Docker files. I used <a href="https://kompose.io">Kompose</a> to convert those to Kubernetes YAML files.</p><h2 id="misp">MISP</h2><p>The <a href="https://github.com/MISP/misp-docker">misp-docker</a> project uses four containers: misp-core, misp-modules, mariadb, and redis. Kompose converted those into four deployments, four services, and four persistent volume claims. I had some issues with the mariadb container, so I used the <a href="https://bitnami.com/stack/mariadb/helm">Bitnami MariaDB</a> Helm Chart. I specify the database variables in the values YAML:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>  extraEnvVars:
- name: MARIADB_DATABASE
  value: &lt;database_name&gt;
- name: MARIADB_PASSWORD
  value: &lt;user_password&gt;
- name: MARIADB_ROOT_PASSWORD
  value: &lt;root_password&gt;
- name: MARIADB_USER
  value: &lt;username&gt;
</pre></table></code></div></div><p>I condensed the misp-core container into one file with both a Deployment and a Service. Make sure the MYSQL_* variables match the MARIADB_* variables from above.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
</pre><td class="rouge-code"><pre>apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
	kompose.cmd: kompose --file docker-compose.yml convert
	kompose.version: 1.26.0 (40646f47)
  creationTimestamp: null
  labels:
	io.kompose.service: misp-core
  name: misp-core
  namespace: misp
spec:
  replicas: 1
  selector:
	matchLabels:
	  io.kompose.service: misp-core
  strategy:
	type: Recreate
  template:
	metadata:
	  annotations:
		kompose.cmd: kompose --file docker-compose.yml convert
		kompose.version: 1.26.0 (40646f47)
	  creationTimestamp: null
	  labels:
		io.kompose.service: misp-core
	spec:
	  containers:
		- env:
			- name: ADMIN_EMAIL
			  value: &lt;misp_admin_email&gt;
			- name: ADMIN_PASSWORD
			  value: &lt;misp_admin_password&gt;
			- name: BASE_URL
			  value: https://misp.jhu-ctih.training
			- name: MYSQL_DATABASE
			  value: &lt;database_name&gt;
			- name: MYSQL_HOST
			  value: misp-db-mariadb # internal Kubernetes networking resolution
			- name: MYSQL_PASSWORD
			  value: &lt;user_password&gt;
			- name: MYSQL_PORT
			  value: "3306"
			- name: MYSQL_USER
			  value: &lt;username&gt;
			- name: REDIS_FQDN
			  value: misp-redis  # internal Kubernetes networking resolution
			- name: SYNCSERVERS_1_DATA
			  value: |2

				{
				  "remote_org_uuid": "",
				  "name": "",
				  "authkey": "",
				  "url": "",
				  "pull": true
				}
		  image: ghcr.io/misp/misp-docker/misp-core:latest
		  name: misp-core
		  ports:
			- containerPort: 80
			- containerPort: 443
		  resources: {}
		  volumeMounts:
			- mountPath: /var/www/MISP/app/Config/
			  name: misp-core-config
			- mountPath: /var/www/MISP/app/tmp/logs/
			  name: misp-core-logs
			- mountPath: /var/www/MISP/app/files/
			  name: misp-core-files
			- mountPath: /etc/nginx/certs/
			  name: misp-core-certs
			- mountPath: /var/www/MISP/.gnupg/
			  name: misp-core-gnupg
	  restartPolicy: Always
	  volumes:
		- name: misp-core-config
		  nfs:
			server: &lt;nfs_servername&gt;
			path: /nfs_storage/kube/misp/www-data/app/Config
		- name: misp-core-logs
		  nfs:
			server: &lt;nfs_servername&gt;
			path: /nfs_storage/kube/misp/www-data/app/tmp/logs
		- name: misp-core-files
		  nfs:
			server: &lt;nfs_servername&gt;
			path: /nfs_storage/kube/misp/www-data/app/files
		- name: misp-core-certs
		  nfs:
			server: &lt;nfs_servername&gt;
			path: /nfs_storage/kube/misp/www-data/nginx/certs
		- name: misp-core-gnupg
		  nfs:
			server: &lt;nfs_servername&gt;
			path: /nfs_storage/kube/misp/www-data/gnupg
status: {}
---
apiVersion: v1
kind: Service
metadata:
  annotations:
	kompose.cmd: kompose --file docker-compose.yml convert
	kompose.version: 1.26.0 (40646f47)
  creationTimestamp: null
  labels:
	io.kompose.service: misp-core
  name: misp-core
  namespace: misp
spec:
  ports:
	- name: "80"
	  port: 80
	  targetPort: 80
	- name: "443"
	  port: 443
	  targetPort: 443
  selector:
	io.kompose.service: misp-core
status:
  loadBalancer: {}
</pre></table></code></div></div><p>The manifests for misp-modules and redis worked without modification.</p><h2 id="caldera">Caldera</h2><p>The manifests created by Kompose tried to pull caldera:latest, but the image does not exist. Caldera uses Docker RUN to set up the container. I changed the image to ubuntu:latest, and used a <a href="https://kubernetes.io/docs/concepts/configuration/configmap/">ConfigMap</a> to define a shell script the implements all of the RUN commands to do the container setup.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
</pre><td class="rouge-code"><pre>apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
	kompose.cmd: kompose convert
	kompose.version: 1.31.2 (a92241f79)
  creationTimestamp: null
  labels:
	io.kompose.service: caldera
  name: caldera
  namespace: caldera
spec:
  replicas: 1
  selector:
	matchLabels:
	  io.kompose.service: caldera
  strategy:
	type: Recreate
  template:
	metadata:
	  annotations:
		kompose.cmd: kompose convert
		kompose.version: 1.31.2 (a92241f79)
	  creationTimestamp: null
	  labels:
		io.kompose.network/caldera-default: "true"
		io.kompose.service: caldera
	spec:
	  containers:
		- image: ubuntu:latest
		  name: caldera
		  command: ["/bin/entrypoint.sh"]
		  volumeMounts:
			- name: caldera-app
			  mountPath: /usr/src/app
			- name: configmap-volume
			  mountPath: /bin/entrypoint.sh
			  readOnly: true
			  subPath: entrypoint.sh
		  env:
			- name: VIRTUAL_ENV
			  value: /opt/venv/caldera
			- name: TZ
			  value: UTC
			- name: WIN_BUILD
			  value: "true"
		  workingDir: /usr/src/app
		  ports:
			- containerPort: 8888
			  hostPort: 8888
			  protocol: TCP
			- containerPort: 8443
			  hostPort: 8443
			  protocol: TCP
			- containerPort: 7010
			  hostPort: 7010
			  protocol: TCP
			- containerPort: 7011
			  hostPort: 7011
			  protocol: UDP
			- containerPort: 7012
			  hostPort: 7012
			  protocol: TCP
			- containerPort: 8853
			  hostPort: 8853
			  protocol: TCP
			- containerPort: 8022
			  hostPort: 8022
			  protocol: TCP
			- containerPort: 2222
			  hostPort: 2222
			  protocol: TCP
		  resources: {}
	  restartPolicy: Always
	  volumes:
		- name: caldera-app
		  nfs:
			server: &lt;nfs_servername&gt;
			path: /nfs_storage/kube/caldera/caldera
		- name: configmap-volume
		  configMap:
			defaultMode: 0700
			name: configmap-caldera
status: {}
</pre></table></code></div></div><p>Hereâ€™s the ConfigMap:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre><td class="rouge-code"><pre>apiVersion: v1
kind: ConfigMap
metadata:
  name: configmap-caldera
  namespace: caldera
data:
  entrypoint.sh: |
	#!/bin/bash
	function initCaldera {
	  if [ -z "$(ls plugins/stockpile)" ]; then echo "stockpile plugin not downloaded - please ensure you recursively cloned the caldera git repository and try again."; exit 1; fi
	  apt-get update &amp;&amp; apt-get -y install python3 python3-pip python3-venv git curl golang-go
	  if [ "$WIN_BUILD" = "true" ] ; then apt-get -y install mingw-w64; fi
	  python3 -m venv $VIRTUAL_ENV
	  PATH="$VIRTUAL_ENV/bin:$PATH"
	  pip3 install --no-cache-dir -r requirements.txt
	  python3 -c "import app; import app.utility.config_generator; app.utility.config_generator.ensure_local_config();"
	  sed -i '/\- atomic/d' conf/local.yml
	  cd /usr/src/app/plugins/sandcat/gocat
	  go mod tidy &amp;&amp; go mod download
	  cd /usr/src/app/plugins/sandcat
	  if [ "$WIN_BUILD" = "true" ] ; then 
		cp ./update-agents.sh ./update-agents-copy.sh
	  fi
	  if [ "$WIN_BUILD" = "true" ] ; 
		then tr -d '\15\32' &lt; ./update-agents-copy.sh &gt; ./update-agents.sh
	  fi
	  if [ "$WIN_BUILD" = "true" ] ; then 
		rm ./update-agents-copy.sh
	  fi
	  ./update-agents.sh
	  mkdir /tmp/gocatextensionstest
	  cp -R ./gocat /tmp/gocatextensionstest/gocat
	  cp -R ./gocat-extensions/* /tmp/gocatextensionstest/gocat/
	  cp ./update-agents.sh /tmp/gocatextensionstest/update-agents.sh
	  cd /tmp/gocatextensionstest
	  mkdir /tmp/gocatextensionstest/payloads
	  ./update-agents.sh
	  if [ ! -d "/usr/src/app/plugins/atomic/data/atomic-red-team" ]; then 
		git clone --depth 1 https://github.com/redcanaryco/atomic-red-team.git; /usr/src/app/plugins/atomic/data/atomic-red-team
	  fi
	  cd /usr/src/app/plugins/emu
	  if [ $(grep -c "\- emu" ../../conf/local.yml)  ]; then
		apt-get -y install zlib1g unzip; pip3 install -r requirements.txt
		./download_payloads.sh
	  fi
	  touch /usr/src/app/.configured
	}
	if [ ! -f /usr/src/app/.configured ]; then 
	  initCaldera
	fi
	PATH="$VIRTUAL_ENV/bin:$PATH"
	cd /usr/src/app
	python3 server.py --log DEBUG
</pre></table></code></div></div><h2 id="cape">CAPE</h2><p>CAPE did not get converted to Kubernetes since it still needs to run VMs to detonate malware.</p><h2 id="exposing-services">Exposing Services</h2><p>The MISP and Caldera servers are now available within the Kubernetes network. To expose them, I deploy Traefik IngressRoutes. An IngressRoute is also used to pass cape.jhu-ctih.training to an ExternalService.</p><p>I applied some custom configurations to Traefik. MISP uses a self-signed certificate which Traefik will not validate. I request a specific IP from MetalLB. Each service runs in its own namespace, so I allow cross-namespace access. Since CAPE is an external service to the Kubernetes cluster, I allow external name service access.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>service:
  enabled: true
  single: true
  type: LoadBalancer
  spec: {}
  loadBalancerIP: "&lt;requested_ip_in_metallb_range&gt;"
providers:
	kubernetesCRD:
	  enabled: true
	  allowCrossNamespace: true
	  allowExternalNameServices: true
additionalArguments: 
	- --serverstransport.insecureskipverify=true
</pre></table></code></div></div><p>Then for each service, create an IngressRoute:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
</pre><td class="rouge-code"><pre>apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  name: jhu-ctih-https
spec:
  entryPoints:
	- websecure
  routes:
	- match: Host(`misp.jhu-ctih.training`)
	  kind: Rule
	  services:
		- name: misp-core
		  port: 443
		  namespace: misp
---
apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  name: jhu-ctih-https
spec:
  entryPoints:
	- websecure
  routes:
	- match: Host(`caldera.jhu-ctih.training`)
	  kind: Rule
	  services:
		- name: caldera
		  port: 8888
		  namespace: caldera
---
kind: Service
apiVersion: v1
metadata:
  name: cape-service
spec:
  type: ExternalName
  ports:
	- port: 8000  # This port and the port below must match
  externalName: &lt;cape_server_ip&gt;
---
apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  name: cape-ingress
spec:
  entryPoints:
	- websecure
  routes:
	- match: Host(`cape.jhu-ctih.training`)
	  kind: Rule
	  priority: 1
	  services:
		- name: cape-service
		  port: 8000  # Thought this was Traefik listen port, but must match above
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/homelab/" class="post-tag no-text-decoration" >homelab</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Learning Kubernetes - kimobu&url=https://kimobu.github.io/posts/Kubernetes/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Learning Kubernetes - kimobu&u=https://kimobu.github.io/posts/Kubernetes/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Learning Kubernetes - kimobu&url=https://kimobu.github.io/posts/Kubernetes/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/SecurityOnion-GPT/">SecurityOnion GPT</a><li><a href="/posts/Adding-Phishing-to-the-Homelab/">Putting phishing data into Security Onion</a><li><a href="/posts/Books-of-2022/">Recap of the books I read in 2022</a><li><a href="/posts/Books-of-2021/">Recap of the books I read in 2021</a><li><a href="/posts/Books-of-2017/">Recap of the books I read in 2017</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/books/">books</a> <a class="post-tag" href="/tags/homelab/">homelab</a> <a class="post-tag" href="/tags/research/">research</a> <a class="post-tag" href="/tags/school/">school</a> <a class="post-tag" href="/tags/dns/">dns</a> <a class="post-tag" href="/tags/doh/">doh</a> <a class="post-tag" href="/tags/networking/">networking</a> <a class="post-tag" href="/tags/offsec/">offsec</a> <a class="post-tag" href="/tags/ai/">ai</a> <a class="post-tag" href="/tags/kali/">kali</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Security-Onion-Proxmox/"><div class="card-body"> <span class="timeago small" > May 26, 2021 <i class="unloaded">2021-05-26T00:00:00-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Security Onion on Proxmox</h3><div class="text-muted small"><p> Security Onion on Proxmox I originally set up my homelab using Ovirt, but have since switched back to Proxmox. The reason for that is that the version of qemu that Ovirt ships with does not support...</p></div></div></a></div><div class="card"> <a href="/posts/log4j-JDNI-Exploitation/"><div class="card-body"> <span class="timeago small" > Dec 10, 2021 <i class="unloaded">2021-12-10T00:00:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>log4j JNDI Exploitation</h3><div class="text-muted small"><p> Situation A remote code execution (RCE) bug was found in log4j. CVE 2021-44228 has been assigned to it. The vulnerability lies in how log4j interprets Java Naming and Directory Interface (JNDI) URL...</p></div></div></a></div><div class="card"> <a href="/posts/macOS-Homelab/"><div class="card-body"> <span class="timeago small" > May 10, 2023 <i class="unloaded">2023-05-10T00:00:00-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Adding macOS to my security homelab</h3><div class="text-muted small"><p> This post has notes on how I added a macOS machine to my security homelab. Install macOS to Proxmox Follow this guide to install macOS onto a Proxmox cluster. This will result in an x86 based VM. ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Books-of-2023/" class="btn btn-outline-primary" prompt="Older"><p>Recap of the books I read in 2023</p></a> <a href="/posts/SecurityOnion-GPT/" class="btn btn-outline-primary" prompt="Newer"><p>SecurityOnion GPT</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> Â© 2024 <a href="https://github.com/kimobu">Kimo B</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/books/">books</a> <a class="post-tag" href="/tags/homelab/">homelab</a> <a class="post-tag" href="/tags/research/">research</a> <a class="post-tag" href="/tags/school/">school</a> <a class="post-tag" href="/tags/dns/">dns</a> <a class="post-tag" href="/tags/doh/">doh</a> <a class="post-tag" href="/tags/networking/">networking</a> <a class="post-tag" href="/tags/offsec/">offsec</a> <a class="post-tag" href="/tags/ai/">ai</a> <a class="post-tag" href="/tags/kali/">kali</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://kimobu.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
